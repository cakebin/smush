<div *ngIf="user" class="row">
    <div class="col-2"></div>
    <div class="col-8">


        <div class="card border-0">
            <div class="card-body">
                <h4 class="mb-4">Account details</h4>

                <div class="form-group">
                    <label for="email-address">Email address</label>
                    <input disabled [(ngModel)]="editedUser.emailAddress" type="text" name="email-address" class="form-control" /> 
                </div>
              
                <div class="form-group">
                    <label for="display-name">Display name</label>
                    <input [(ngModel)]="editedUser.userName" type="text" name="display-name" class="form-control" /> 
                </div>
             
                
                <div class="form-group">
                    <label for="user-character">
                        Default character 
                        <fa-icon 
                        [icon]="faQuestionCircle" 
                        placement="right" 
                        ngbTooltip="Who likes unnecessary and repetitive typing? We'll automagically fill the match input form with this character for you.">
                        </fa-icon>
                    </label>

                    <common-ux-typeahead 
                    [items]="characters" 
                    [textPropertyName]="'characterName'" 
                    [valuePropertyName]="'characterId'" 
                    [value]="editedUser.defaultCharacterId" 
                    (selectItem)="onSelectDefaultCharacter($event)" 
                    id="default-character"></common-ux-typeahead>
                </div>
            
                <div class="form-group">
                    <label for="user-gsp">
                        Default GSP 
                        <fa-icon 
                        [icon]="faQuestionCircle" 
                        placement="right" 
                        ngbTooltip="Typing in our GSPs over and over was the hardest part of testing this app. We'll do you a solid with this GSP auto-fill option.">
                        </fa-icon>
                    </label>
                    <common-ux-masked-number-input [(numberValue)]="editedUser.defaultCharacterGsp"></common-ux-masked-number-input>
                </div>
            

                <h4 class="mb-4" style="margin-top:50px;">Saved characters</h4>
                
                <ng-container *ngIf="savedCharactersTestData?.length">
                    <table class="table table-borderless table-sm table-striped table-hover mb-0">
                        <thead class="thead-light">
                            <tr>
                                <th class="pl-3">Character name</th>
                                <th class="pl-3">Character GSP</th>
                                <th style="width:150px;"><!-- Edit actions --></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let char of savedCharactersTestData; index as i" [ngClass]="{'bg-primary text-white':char.isDefault}" >
                                <td class="align-middle" [ngClass]="{'pl-3':!char.editMode}">
                                    <span *ngIf="char.editMode">
                                        <common-ux-typeahead 
                                        [items]="characters"
                                        [textPropertyName]="'characterName'" 
                                        [valuePropertyName]="'characterId'" 
                                        [value]="char.id" 
                                        (selectItem)="onSelectSavedCharacter($event, char)">
                                        </common-ux-typeahead>
                                    </span>
                                    <span *ngIf="!char.editMode">{{char.name}}</span>
                                </td>
                                <td class="align-middle" [ngClass]="{'pl-3':!char.editMode}">
                                    <span *ngIf="char.editMode">
                                        <common-ux-masked-number-input [(numberValue)]="char.gsp"></common-ux-masked-number-input>
                                    </span>
                                    <span *ngIf="!char.editMode">{{char.gsp | stringToNumber | number}}</span>
                                </td>
                                <td class="text-right align-middle">
                                    <div *ngIf="char.editMode" class="btn-group btn-block">
                                        <button (click)="char.editMode=false" class="btn btn-light border-secondary">Ok</button>
                                        <button (click)="char.editMode=false" class="btn btn-light border-secondary">Cancel</button>
                                    </div>
                                    <div *ngIf="!char.editMode" class="btn-group btn-block">
                                        <button *ngIf="char.isDefault" (click)="char.isDefault=false" type="button" class="btn btn-light border-secondary p-1">
                                            Clear default
                                        </button>
                                        <button *ngIf="!char.isDefault" (click)="setDefaultSavedCharacter(char.id)" type="button" class="btn btn-light border-secondary p-1">
                                            Set as default
                                        </button>
                                        <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                                            <button class="btn btn-light border-secondary dropdown-toggle-split p-1" ngbDropdownToggle></button>
                                            <div class="dropdown-menu" ngbDropdownMenu>
                                                <button (click)="setSavedCharacterEditMode(char.id)" ngbDropdownItem>Edit</button>
                                                <button (click)="deleteSavedCharacter(char.id)" ngbDropdownItem>Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <common-ux-typeahead
                                    [items]="characters"
                                    [textPropertyName]="'characterName'" 
                                    [valuePropertyName]="'characterId'" 
                                    [value]="editChar.id">
                                    </common-ux-typeahead>
                                </td>
                                <td>
                                    <common-ux-masked-number-input [(numberValue)]="editChar.gsp"></common-ux-masked-number-input>
                                </td>
                                <td class="text-right align-middle">
                                    <button class="btn btn-block btn-secondary p-1">Add character</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <small class="text-muted font-italic">Changes in table are only committed when you click "Save changes".</small>
                </ng-container>

                <div *ngIf="!savedCharactersTestData?.length" class="text-center no-data-block">
                    <h3 class="text-black-50">No characters found</h3>
                </div>


                <div class="form-group text-center" style="margin-top:50px;">
                    <button [disabled]="!formChanged || isSaving" (click)="updateUser()"
                    type="submit" class="btn btn-primary">
                        Save changes
                    </button>
                </div>
            </div>
        </div>


    </div>
    <div class="col-2"></div>
</div>
