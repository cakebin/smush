<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">
        <img src="/static/assets/logo_transparent.png" width="30" height="30" class="d-inline-block align-top" alt="Smush Tracker">
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" routerLink="/home">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" [ngClass]="{'disabled': !user}" routerLink="/matches">Matches</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" [ngClass]="{'disabled': !user}" routerLink="/insights">Insights</a>
            </li>
        </ul>
        
        <div *ngIf="user" class="btn-group">
            <button routerLink="/profile/view" type="button" class="btn btn-secondary">
                {{user?.userName}}
            </button>
            <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                <button class="btn btn-secondary dropdown-toggle-split" ngbDropdownToggle></button>
                <div class="dropdown-menu dropdown-menu-right" ngbDropdownMenu>
                    <button routerLink="/profile/edit" ngbDropdownItem>Edit Profile</button>
                    <button (click)="logOut()" ngbDropdownItem>Log Out</button>
                </div>
            </div>
        </div>

        <div *ngIf="!user" ngbDropdown class="d-inline-block">
            <button class="btn btn-outline-secondary" id="dropdownForm1" ngbDropdownToggle>Log in </button>
            
            <div ngbDropdownMenu class="user-form-dropdown dropdown-menu-right" aria-labelledby="dropdownForm1">
                
                <div *ngIf="showLoginForm; then loginForm else registerForm"></div>

                <div class="dropdown-divider"></div>
                <button *ngIf="showLoginForm else loginButton" (click)="showLoginForm=false" class="user-form-button">New around here? Sign up</button>
                <ng-template #loginButton><button (click)="showLoginForm=true" class="user-form-button">Already registered? Sign in</button></ng-template>
                <button class="user-form-button">Forgot password?</button>
            </div>
        </div>
    </div>
</nav>





<ng-template #loginForm>
    <div class="px-4 py-3">
        <div class="form-group mb-1">
            <label for="dropdownFormEmail" class="mb-0">Email address</label>
            <input [(ngModel)]="logInModel.emailAddress" type="email" class="form-control" id="dropdownFormEmail">
        </div>
        <div class="form-group mb-1">
            <label for="dropdownFormPassword" class="mb-0">Password</label>
            <input [(ngModel)]="logInModel.password" type="password" class="form-control" id="dropdownFormPassword">
        </div>
        <div class="form-check">
            <input [(ngModel)]="logInModel.remember" type="checkbox" class="form-check-input" id="dropdownCheck">
            <label class="form-check-label" for="dropdownCheck">
            Remember me
            </label>
        </div>
        <button (click)="logIn()" class="btn btn-primary mt-1">Sign in</button>
    </div>
</ng-template>

<ng-template #registerForm>
    <div (keyUp)="justCheckedCreateUserForm=false" class="px-4 py-3">
        <div class="form-group mb-1">
            <label for="dropdownFormEmail" class="mb-0">Email address</label>
            <input [(ngModel)]="newUser.emailAddress" (keyup)="justCheckedCreateUserForm=false" type="email" class="form-control"
            [ngClass]="{ 'border-danger': (!newUser.emailAddress && justCheckedCreateUserForm) }" id="dropdownFormEmail">
        </div>
        <div class="form-group mb-1">
            <label for="dropdownFormUserName" class="mb-0">Username</label>
            <input [(ngModel)]="newUser.userName" (keyup)="justCheckedCreateUserForm=false" type="text" class="form-control" 
            [ngClass]="{ 'border-danger': (!newUser.userName && justCheckedCreateUserForm) }" id="dropdownFormUserName">
        </div>
        <div class="form-group mb-1">
            <label for="dropdownFormPassword1" class="mb-0">Password</label>
            <input [(ngModel)]="newUser.password" (keyup)="justCheckedCreateUserForm=false" type="password" class="form-control" 
            [ngClass]="{ 'border-danger': (!newUser.password && justCheckedCreateUserForm) }" id="dropdownFormPassword1">
        </div>
        <div class="form-group mb-1">
            <label for="dropdownFormPassword2" class="mb-0">Confirm Password</label>
            <input [(ngModel)]="newUser.passwordConfirm" (keyup)="justCheckedCreateUserForm=false" type="password" class="form-control" 
            [ngClass]="{ 'border-danger': ((newUser.passwordConfirm && newUser.passwordConfirm!==newUser.password) 
            || (!newUser.passwordConfirm && justCheckedCreateUserForm)) }" id="dropdownFormPassword2">
        </div>
        <button (click)="createUser();" class="btn btn-primary mt-1">Register</button>
    </div>
</ng-template>

<ng-template #createUserWarningsTemplate>
    Please address the following problems:
    <ul>
        <li *ngFor="let warning of createUserWarnings">{{warning}}</li>
    </ul>
</ng-template>